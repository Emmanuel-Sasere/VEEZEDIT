//function for load cart message
function loadCartCustomMessage(data) {
    try {
      //insert message on cart page
      var messagePosition = null;
      if (
        document.getElementsByTagName("cart-items")[0] &&
        document.getElementsByTagName("cart-items")[0].offsetHeight > 0
      )
        messagePosition = document.getElementsByTagName("cart-items")[0];
      var messagePositionDefault = document.querySelectorAll(
        'form[action="/cart"]'
      );
      const messageDiv = document.getElementById("id_div_share_cart_message");
      var customMessageFieldValue = null;
      if (
        !messageDiv &&
        (messagePosition || messagePositionDefault) &&
        shareCartCurrentStateData &&
        shareCartCurrentStateData.checked &&
        shareCartCurrentStateData.checked === true &&
        data.attributes.customMessage &&
        data.attributes.customMessage.length > 0 &&
        shareCartCurrentStateData.customCartMessageStatus
      ) {
        customMessageFieldValue = emojione.shortnameToImage(
          data.attributes.customMessage
        );
        if (customMessageFieldValue) {
          const messageHtmlElement = createElementFromHTML(`
                  <div class="custom_css_priority1 custom_css_priority2">
                  <div id="id_div_share_cart_message" 
                  class="custom_cart_msg"
                  style="display: flex;
                  background-color:${shareCartCurrentStateData.basicBackgroundColorMsg.value};
                  border: ${shareCartCurrentStateData.borderWidthMsg}px solid ${shareCartCurrentStateData.basicBorderColorMsg.value};
                  border-radius: ${shareCartCurrentStateData.borderRadiusMsg}px;
                  padding: 5px 10px;
                  margin: 10px 0px;
                  justify-content: space-between;
                  flex-grow: 1;
                  align-items: center;
                  font-size: ${shareCartCurrentStateData.customMsgFontSize}px;
                  font-weight: ${shareCartCurrentStateData.customMsgWeight};
                  color: ${shareCartCurrentStateData.basicTextColorMsg.value};
                  font-family: share-cart-font, MyFont, myFont;">
            <p style="
            margin: 0px;
            font-size: inherit;
            font-weight: inherit;
            color: inherit;
            font-family: inherit;"
            >
                    ${customMessageFieldValue}
            </p>
            <div style="display: flex;
                        justify-content: center;
                        align-items: center;"
            >
              <span 
                id="share_cart_message_close_btn"
                style="  
                  all: unset !important;
                  cursor: pointer !important;
                  line-height: 0.7 !important;
                  top: 0 !important;
                  position: relative !important;
                  margin-left: 10px !important;"
                >
                <svg style="fill: ${shareCartCurrentStateData.basicIconColorMsg.value} !important; stroke: ${shareCartCurrentStateData.basicIconColorMsg.value} !important;" xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 512.001 512.001" strokewidth="1">
                  <path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
                        L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
                        c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
                        l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
                        L284.286,256.002z"></path>
                </svg>
              </span>
            </div>
        </div>
                  </div>
                  `);
          if (
            shareCartCurrentStateData.shareMsgPosition &&
            shareCartCurrentStateData.shareMsgPosition === "below"
          ) {
            if (messagePosition) {
              messagePosition.appendChild(messageHtmlElement);
            } else {
              for (let i = 0; i < messagePositionDefault.length; i++) {
                if (messagePositionDefault[i].offsetHeight > 0) {
                  const replacedTextContent = messagePositionDefault[
                    i
                  ].textContent
                    .toLowerCase()
                    .replace(/[^A-Z]/gi, "");
                  if (
                    messagePositionDefault[i].querySelectorAll(
                      `a[href="${cartProductsHref[0]}"]`
                    ).length > 0 ||
                    replacedTextContent.includes("cart") ||
                    replacedTextContent.includes("total")
                  ) {
                    messagePositionDefault = messagePositionDefault[i];
                    break;
                  }
                }
              }
              messagePositionDefault.parentNode.appendChild(messageHtmlElement);
            }
          } else {
            if (messagePosition) {
              messagePosition.insertBefore(
                messageHtmlElement,
                messagePosition.firstChild
              );
            } else {
              for (let i = 0; i < messagePositionDefault.length; i++) {
                if (messagePositionDefault[i].offsetHeight > 0) {
                  const replacedTextContent = messagePositionDefault[
                    i
                  ].textContent
                    .toLowerCase()
                    .replace(/[^A-Z]/gi, "");
                  if (
                    messagePositionDefault[i].querySelectorAll(
                      `a[href="${cartProductsHref[0]}"]`
                    ).length > 0 ||
                    replacedTextContent.includes("cart") ||
                    replacedTextContent.includes("total")
                  ) {
                    messagePositionDefault = messagePositionDefault[i];
                    break;
                  }
                }
              }
              if (
                messagePositionDefault.previousSibling &&
                messagePositionDefault.previousSibling.firstElementChild &&
                messagePositionDefault.previousSibling.firstElementChild.className.includes(
                  "share_cart_wrap"
                )
              ) {
                messagePositionDefault.parentNode.insertBefore(
                  messageHtmlElement,
                  messagePositionDefault.parentElement.firstElementChild
                );
              } else {
                messagePositionDefault.parentNode.insertBefore(
                  messageHtmlElement,
                  messagePositionDefault
                );
              }
            }
          }
          document
            .querySelector("#share_cart_message_close_btn")
            .addEventListener("click", function (event) {
              document.querySelector("#id_div_share_cart_message").style.display =
                "none";
              fetch(`/cart/update.js`, {
                method: "post",
                credentials: "same-origin",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  attributes: {
                    BevySharedLink: true,
                    customMessage: "",
                  },
                }),
              });
            });
        }
      }
    } catch (error) {}
}