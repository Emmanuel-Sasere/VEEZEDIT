function injectEmbedButton() {
  if (typeof emojione != "undefined") {
    const shareButtonEmbedBlock =
      document.getElementsByClassName("bevy_share_button");
    if (shareButtonEmbedBlock.length > 0) {
      for (var i = 0; i < shareButtonEmbedBlock.length; i++) {
        var htmlShareButton = createElementFromHTML(htmltoshow);
        shareButtonEmbedBlock[i].appendChild(htmlShareButton);
      }
      let shareCartBtn = document.querySelectorAll(".share_cart_btn");
      let shareCartModal = document.getElementById("sharecartmodal");
      for (var i = 0; i < shareCartBtn.length; i++) {
        shareCartBtn[i].addEventListener("click", function (event) {
          if (event && event.stopPropagation) event.stopPropagation();
          shareCartModal.style.display = "flex";
          var textInput = document.getElementsByClassName(
            "share_cart_modal_middle"
          );

          if (
            textInput &&
            textInput.length > 0 &&
            textInput[0].getElementsByClassName("social_link").length <= 0
          ) {
            var element = textInput[0];
            var children = element.children;
            var parentWidth = element.offsetWidth;
            var totalChildWidth = 0;
            for (var i = 0; i < children.length; i++) {
              totalChildWidth = children[i].offsetWidth + totalChildWidth;
            }
            if (parentWidth - totalChildWidth <= 20) {
              element.style.flexDirection = "column";
              for (var i = 0; i < children.length; i++) {
                children[i].style.marginRight = "0px";
                if (i < children.length - 1)
                  children[i].style.marginBottom = "20px";
              }
            } else {
              element.style.removeProperty("flex-direction");
              for (var i = 0; i < children.length; i++) {
                children[i].style.removeProperty("margin-right");
                children[i].style.removeProperty("margin-bottom");
              }
            }
          }
        });
      }

      var el = document.getElementsByClassName("id_h2_shoppingcart");
      for (var i = 0; i < el.length; i++) el[i].innerHTML = shoppingcart;
      var element_svg = document.getElementsByClassName("id_span_svgicon");
      for (var i = 0; i < element_svg.length; i++)
        element_svg[i].innerHTML = icontoshow;
      var el_buttontext = document.getElementsByClassName("id_span_buttontext");
      for (var i = 0; i < el_buttontext.length; i++)
        el_buttontext[i].innerHTML = buttontext;
    }
    var cartDrawerElementHref0 = document.querySelectorAll(
      `a[href="${cartProductsHref[0]}"]`
    );
    const cartDrawerButtonPositionList = [];
    for (
      var cartDrawerIdentifyIndex = 0;
      cartDrawerIdentifyIndex < cartDrawerElementHref0.length;
      cartDrawerIdentifyIndex++
    ) {
      let cartHref = cartDrawerElementHref0[cartDrawerIdentifyIndex];
      let cnt = 13;
      let flag = 0;
      while (cnt--) {
        const elementTextConent = cartHref.textContent
          .toLowerCase()
          .replace(/[^a-zA-Z0-9]/g, "");
        if (
          (elementTextConent.includes("checkout") &&
            (elementTextConent.includes("cart") ||
              elementTextConent.includes("total") ||
              elementTextConent.includes("subtotal") ||
              elementTextConent.includes(shareCartData.total_price))) ||
          (cartHref.tagName.toLowerCase() === "form" &&
            cartHref.getAttribute("action").toLowerCase() === "/cart")
        ) {
          flag = 1;
          break;
        }
        cartHref = cartHref.parentElement;
      }
      if (flag) {
        cartDrawerButtonPositionList.push(cartHref);
      }
    }

    for (
      var cartDrawerButtonPositionNumber = 0;
      cartDrawerButtonPositionNumber < cartDrawerButtonPositionList.length;
      cartDrawerButtonPositionNumber++
    ) {
      cartDrawerBevyShareButtonPosition =
        cartDrawerButtonPositionList[cartDrawerButtonPositionNumber];
      if (
        cartDrawerBevyShareButtonPosition.parentNode.getElementsByClassName(
          "share_cart_wrap"
        ).length <= 0
      ) {
        var formValid = false;
        if (
          cartDrawerBevyShareButtonPosition.parentNode.querySelectorAll(
            'form[action="/cart"]'
          ).length > 0
        ) {
          const formElement =
            cartDrawerBevyShareButtonPosition.parentNode.querySelectorAll(
              'form[action="/cart"]'
            )[0];

          const replacedTextContent = formElement.textContent
            .toLowerCase()
            .replace(/[^A-Z]/gi, "");
          if (
            formElement.querySelectorAll(`a[href="${cartProductsHref[0]}"]`)
              .length > 0 ||
            replacedTextContent.includes("cart") ||
            replacedTextContent.includes("total")
          ) {
            if (
              formElement.id === "mini-cart" ||
              formElement.className.includes("cart-recap")
            ) {
              formValid = false;
            } else {
              formValid = true;
            }
          }
        }
        if (!formValid) {
          //Inserting message
          if (
            shareCartData.attributes.customMessage &&
            shareCartData.attributes.customMessage.length > 0 &&
            shareCartCurrentStateData.customCartMessageStatus
          ) {
            const customMessageFieldValue = emojione.shortnameToImage(
              shareCartData.attributes.customMessage
            );
            var marLeft = "0";
            var marRight = "0";
            if (document.getElementById("slidecarthq")) {
              marLeft = "20";
              marRight = "10";
            }
            const messageHtmlElement = createElementFromHTML(`
                  <div class="custom_css_priority1 custom_css_priority2">
                  <div class="div_share_cart_message custom_cart_msg"
                            style="display: flex;
                            padding: 5px 10px;
                            margin: 10px 0px;
                            margin-left: ${marLeft}px;
                            margin-right: ${marRight}px;
                            margin-top: 20px;
                            background-color:${shareCartCurrentStateData.basicBackgroundColorMsg.value};
                            border: ${shareCartCurrentStateData.borderWidthMsg}px solid ${shareCartCurrentStateData.basicBorderColorMsg.value};
                            border-radius: ${shareCartCurrentStateData.borderRadiusMsg}px;
                            justify-content: space-between;
                            flex-grow: 1;
                            align-items: center;
                            font-size: ${shareCartCurrentStateData.customMsgFontSize}px;
                              font-weight: ${shareCartCurrentStateData.customMsgWeight};
                              color: ${shareCartCurrentStateData.basicTextColorMsg.value};
                              font-family: share-cart-font, MyFont, myFont;">
                      <p style="font-size: inherit;
                              font-weight: inherit;
                              color: inherit;
                              font-family: inherit;
                              margin: 0px;">
                              ${customMessageFieldValue}
                      </p>
                      <div style="display: flex;
                                  justify-content: center;
                                  align-items: center;"
                      >
                        <span 
                          style="  
                            all: unset !important;
                            cursor: pointer !important;
                            line-height: 0.7 !important;
                            top: 0 !important;
                            position: relative !important;
                            margin-left: 10px !important;"
                          >
                          <svg style="fill: ${shareCartCurrentStateData.basicIconColorMsg.value} !important; stroke: ${shareCartCurrentStateData.basicIconColorMsg.value} !important;" xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 512.001 512.001" strokewidth="1">
                            <path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
                                  L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
                                  c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
                                  l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
                                  L284.286,256.002z"></path>
                          </svg>
                        </span>
                      </div>
                  </div>
                  </div>
                  `);
            if (
              shareCartCurrentStateData.shareMsgPosition &&
              shareCartCurrentStateData.shareMsgPosition === "below"
            ) {
              cartDrawerBevyShareButtonPosition.appendChild(messageHtmlElement);
            } else {
              if (
                cartDrawerBevyShareButtonPosition.parentNode.getElementsByClassName(
                  "share_cart_wrap"
                ).length > 0 &&
                !shareCartCurrentStateData.socialSharePositionBottomStatus
              ) {
                cartDrawerBevyShareButtonPosition.parentNode
                  .getElementsByClassName("share_cart_wrap")[0]
                  .parentNode.parentNode.insertBefore(
                    messageHtmlElement,
                    cartDrawerBevyShareButtonPosition.parentNode.getElementsByClassName(
                      "share_cart_wrap"
                    )[0].parentNode
                  );
              } else {
                if (
                  cartDrawerBevyShareButtonPosition.children.length > 0 &&
                  cartDrawerBevyShareButtonPosition.offsetHeight > 0
                ) {
                  if (
                    cartDrawerBevyShareButtonPosition.children.length === 2 ||
                    (cartDrawerBevyShareButtonPosition.children.length === 3 &&
                      cartDrawerBevyShareButtonPosition.parentNode.getElementsByClassName(
                        "share_cart_wrap"
                      ).length > 0)
                  ) {
                    cartDrawerBevyShareButtonPosition.insertBefore(
                      messageHtmlElement,
                      cartDrawerBevyShareButtonPosition.children[0]
                    );
                  } else
                    cartDrawerBevyShareButtonPosition.insertBefore(
                      messageHtmlElement,
                      cartDrawerBevyShareButtonPosition.children[1]
                    );
                }
              }
            }
            if (
              cartDrawerBevyShareButtonPosition.parentNode.querySelector(
                ".share_cart_message_close_btn"
              )
            )
              cartDrawerBevyShareButtonPosition.parentNode
                .querySelector(".share_cart_message_close_btn")
                .addEventListener("click", function (event) {
                  const customMessageElement = document.getElementsByClassName(
                    "div_share_cart_message"
                  );
                  for (
                    let customMessageElementNumber = 0;
                    customMessageElementNumber < customMessageElement.length;
                    customMessageElementNumber++
                  ) {
                    customMessageElement[
                      customMessageElementNumber
                    ].style.display = "none";
                  }
                  fetch(`/cart/update.js`, {
                    method: "post",
                    credentials: "same-origin",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                      attributes: {
                        BevySharedLink: true,
                        customMessage: "",
                      },
                    }),
                  });
                });
          }
        }
      }
    }

    var node = document.querySelectorAll('form[action="/cart"]');
    var buttonFormElement = [];
    for (let i = 0; i < node.length; i++) {
      if (node[i].offsetHeight > 0) {
        const replacedTextContent = node[i].textContent
          .toLowerCase()
          .replace(/[^A-Z]/gi, "");
        if (
          node[i].querySelectorAll(`a[href="${cartProductsHref[0]}"]`).length >
            0 ||
          replacedTextContent.includes("cart") ||
          replacedTextContent.includes("total")
        ) {
          node = node[i];
          buttonFormElement.push(node);
          break;
        }
      }
    }

    for (var bFrmElNum = 0; bFrmElNum < buttonFormElement.length; bFrmElNum++) {
      node = buttonFormElement[bFrmElNum];
      //Inserting message
      if (
        shareCartData.attributes.customMessage &&
        shareCartData.attributes.customMessage.length > 0 &&
        shareCartCurrentStateData.customCartMessageStatus &&
        node.parentNode.getElementsByClassName("div_share_cart_message")
          .length <= 0
      ) {
        const customMessageFieldValue = emojione.shortnameToImage(
          shareCartData.attributes.customMessage
        );
        var marLeft = "0";
        var marRight = "0";
        if (document.getElementById("slidecarthq")) {
          marLeft = "20";
          marRight = "10";
        }
        const messageHtmlElement = createElementFromHTML(`
                  <div class="custom_css_priority1 custom_css_priority2">
                  <div class="div_share_cart_message  !important"
                            style="display: flex;
                            padding: 5px 10px;
                            margin: 10px 0px;
                            margin-left: ${marLeft}px;
                            margin-right: ${marRight}px;
                            margin-top: 20px;
                            background-color:${shareCartCurrentStateData.basicBackgroundColorMsg.value};
                            border: ${shareCartCurrentStateData.borderWidthMsg}px solid ${shareCartCurrentStateData.basicBorderColorMsg.value};
                            border-radius: ${shareCartCurrentStateData.borderRadiusMsg}px;
                            justify-content: space-between;
                            flex-grow: 1;
                            align-items: center;
                            font-size: ${shareCartCurrentStateData.customMsgFontSize}px;
                              font-weight: ${shareCartCurrentStateData.customMsgWeight};
                              color: ${shareCartCurrentStateData.basicTextColorMsg.value};
                              font-family: share-cart-font, MyFont, myFont;">
                      <p style="font-size: inherit;
                              font-weight: inherit;
                              color: inherit;
                              font-family: inherit;
                              margin: 0px;">
                              ${customMessageFieldValue}
                      </p>
                      <div style="display: flex;
                                  justify-content: center;
                                  align-items: center;"
                      >
                        <span 
                          style="  
                            all: unset !important;
                            cursor: pointer !important;
                            line-height: 0.7 !important;
                            top: 0 !important;
                            position: relative !important;
                            margin-left: 10px !important;"
                          >
                          <svg style="fill: ${shareCartCurrentStateData.basicIconColorMsg.value} !important; stroke: ${shareCartCurrentStateData.basicIconColorMsg.value} !important;" xmlns="http://www.w3.org/2000/svg" width="13" height="13" viewBox="0 0 512.001 512.001" strokewidth="1">
                            <path d="M284.286,256.002L506.143,34.144c7.811-7.811,7.811-20.475,0-28.285c-7.811-7.81-20.475-7.811-28.285,0L256,227.717
                                  L34.143,5.859c-7.811-7.811-20.475-7.811-28.285,0c-7.81,7.811-7.811,20.475,0,28.285l221.857,221.857L5.858,477.859
                                  c-7.811,7.811-7.811,20.475,0,28.285c3.905,3.905,9.024,5.857,14.143,5.857c5.119,0,10.237-1.952,14.143-5.857L256,284.287
                                  l221.857,221.857c3.905,3.905,9.024,5.857,14.143,5.857s10.237-1.952,14.143-5.857c7.811-7.811,7.811-20.475,0-28.285
                                  L284.286,256.002z"></path>
                          </svg>
                        </span>
                      </div>
                  </div>
                  </div>
                  `);
        if (
          shareCartCurrentStateData.shareMsgPosition &&
          shareCartCurrentStateData.shareMsgPosition === "below"
        ) {
          node.parentNode.appendChild(messageHtmlElement);
        } else {
          node.parentNode.insertBefore(messageHtmlElement, node);
        }
        if (node.parentNode.querySelector(".share_cart_message_close_btn"))
          node.parentNode
            .querySelector(".share_cart_message_close_btn")
            .addEventListener("click", function (event) {
              const customMessageElement = document.getElementsByClassName(
                "div_share_cart_message"
              );
              for (
                let customMessageElementNumber = 0;
                customMessageElementNumber < customMessageElement.length;
                customMessageElementNumber++
              ) {
                customMessageElement[customMessageElementNumber].style.display =
                  "none";
              }
              fetch(`/cart/update.js`, {
                method: "post",
                credentials: "same-origin",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  attributes: {
                    BevySharedLink: true,
                    customMessage: "",
                  },
                }),
              });
            });
      }
    }
  } else {
    setTimeout(() => {
      injectEmbedButton();
    }, 2000);
  }
}
